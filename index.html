<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        .bloco {
            background-color: red;
            border-radius: 0.5em;
            box-shadow: 2px 2px 5px #AAAAAA;
            color: black;
            height: 5em;
            position: absolute;
            width: 5em;
        }
        
        .bloco:hover {
            box-shadow: 2px 2px 19px #AAAAAA;
            cursor: pointer;
        }
        
        .button_add,
        .button_add_bloco,
        .button_remove,
        .button {
            background-color: deepskyblue;
            text-align: center;
            border: 1px solid;
        }
        
        .button_container {
            margin: 5px;
            background-color: #aaaaaa
        }
        /* .jtk-endpoint {
            background: yellow;
        } */
        
        .aRedEndpoint svg circle {
            fill: red;
            stroke: yellow;
        }
    </style>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.12.6/js/jsplumb.min.js"></script>
</head>

<body>

    <!-- Adds new blocos to the page -->
    <div class="bloco" style="left: 600px" id="details">
        <p style="text-align: center">Bloco</p>
        <div class="button_container">
            <div class="button_add_bloco">Novo</div>
        </div>
    </div>

    <script>
        function getBlocos() {

        }

        function createNewBloco() {
            var id = "dynamic_" + $(".bloco").length;

            //create new bloco and add it to the body
            $('<div class="bloco" id="' + id + '" >').appendTo('body');

            jsPlumb.addEndpoint(id, {
                isSource: true,
                isTarget: true,
                connector: ["Flowchart", {
                    cornerRadius: 10,
                    margin: 10,
                    curviness: 15
                }],
                connectorStyle: {
                    strokeWidth: 2,
                    stroke: 'blue',
                    cornerRadius: 20
                },
                anchor: "AutoDefault",
                maxConnections: 5,
                connector: ["Flowchart", {
                    stub: [10, 10],
                    gap: 1,
                    cornerRadius: 5,
                    alwaysRespectStubs: false
                }],
                overlays: [
                    ["Label", {
                        events: {
                            click: function(labelOverlay, originalEvent) {
                                console.log("click on label overlay for :" + labelOverlay.component);
                            }
                        }
                    }]
                ],
                onMaxConnections: function(info, e) {
                    alert("Maximum connections (" + info.maxConnections + ") reached");
                },
            });

            jsPlumb.draggable($('#' + id));
        }


        jsPlumb.ready(function() {

            jsPlumb.connect({
                source: "e1",
                target: "e2",
                connector: "Flowchart",
                endpointHoverStyle: {
                    fill: "red"
                },
                endpointStyle: {
                    fill: "transparent"
                },
                cssClass: "aRedEndpoint",
                connectorStyle: {
                    strokeWidth: 5,
                    stroke: 'blue'
                },
                anchor: "AutoDefault",
                overlays: [
                    ["Arrow", {
                        location: 1,
                        id: "arrow",
                        length: 14,
                        foldback: 0.8
                    }]
                ]
            });

            jsPlumb.Defaults.Overlays = [
                ["Arrow", {
                    location: 1,
                    id: "arrow",
                    length: 14,
                    foldback: 0.8
                }]
            ];

            jsPlumb.bind('dblclick', (function(that) {
                return function(connection, e) {
                    jsPlumb.deleteConnection(connection);
                };
            }(this)));

            //adds new bloco
            $(".button_add_bloco").click(function() {
                createNewBloco();
            });
        });
    </script>

</body>

</html>